<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buyurtma detallari - NextPizza</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- Navbar -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Page Header -->
<div class="bg-light py-4">
  <div class="container">
    <h1 class="mb-0">üì¶ Buyurtma #<span th:text="${order.id}">1</span></h1>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="/">Bosh sahifa</a></li>
        <li class="breadcrumb-item"><a href="/my-orders">Buyurtmalar</a></li>
        <li class="breadcrumb-item active">Detal</li>
      </ol>
    </nav>
  </div>
</div>

<!-- Main Content -->
<div class="container py-5">
  <div class="row">

    <!-- Order Info (Left) -->
    <div class="col-lg-8">
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">üìã Buyurtma ma'lumotlari</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <strong>Buyurtma ID:</strong>
              <p th:text="${order.id}">1</p>
            </div>
            <div class="col-md-6 mb-3">
              <strong>Sana:</strong>
              <p th:text="${#temporals.format(order.orderDate, 'dd.MM.yyyy HH:mm')}">
                01.01.2026 12:00
              </p>
            </div>
            <!-- Status Badge - FIXED -->
            <div class="col-md-6 mb-3">
              <strong>Status:</strong>
              <p>
        <span th:switch="${order.orderStatus}">
            <span th:case="'CREATED'" class="badge bg-info" th:text="${order.orderStatus}">CREATED</span>
            <span th:case="'COOKING'" class="badge bg-warning text-dark" th:text="${order.orderStatus}">COOKING</span>
            <span th:case="'DELIVERING'" class="badge bg-primary" th:text="${order.orderStatus}">DELIVERING</span>
            <span th:case="'COMPLETED'" class="badge bg-success" th:text="${order.orderStatus}">COMPLETED</span>
            <span th:case="*" class="badge bg-danger" th:text="${order.orderStatus}">CANCELLED</span>
        </span>
              </p>
            </div>
            <div class="col-md-6 mb-3">
              <strong>Jami summa:</strong>
              <h5 class="text-success">
                <span th:text="${#numbers.formatDecimal(order.totalPrice, 0, 'COMMA', 0, 'POINT')}">0</span> so'm
              </h5>
            </div>
            <div class="col-12">
              <strong>Yetkazib berish manzili:</strong>
              <p th:text="${order.deliveryAddress}">Manzil</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Order Items -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">üçï Mahsulotlar (<span th:text="${order.totalItems}">0</span> ta)</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
              <tr>
                <th>#</th>
                <th>Mahsulot</th>
                <th>Narx</th>
                <th>Soni</th>
                <th>Jami</th>
              </tr>
              </thead>
              <tbody>
              <tr th:each="item, iterStat : ${order.orderItems}">
                <td th:text="${iterStat.count}">1</td>
                <td th:text="${item.productName}">Pizza Margherita</td>
                <td th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + ' so\'m'">
                  0 so'm
                </td>
                <td th:text="${item.quantity}">1</td>
                <td>
                  <strong th:text="${#numbers.formatDecimal(item.totalPrice, 0, 'COMMA', 0, 'POINT')} + ' so\'m'">
                    0 so'm
                  </strong>
                </td>
              </tr>
              </tbody>
              <tfoot>
              <tr>
                <td colspan="4" class="text-end"><strong>Jami:</strong></td>
                <td>
                  <strong class="text-success"
                          th:text="${#numbers.formatDecimal(order.totalPrice, 0, 'COMMA', 0, 'POINT')} + ' so\'m'">
                    0 so'm
                  </strong>
                </td>
              </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions (Right) -->
    <div class="col-lg-4">
      <div class="card sticky-top" style="top: 20px;">
        <div class="card-header">
          <h5 class="mb-0">‚ö° Amallar</h5>
        </div>
        <div class="card-body">

          <!-- Cancel Order -->
          <form th:if="${order.orderStatus == 'CREATED' or order.orderStatus == 'COOKING'}"
                th:action="@{/orders/{id}/cancel(id=${order.id})}"
                method="post"
                onsubmit="return confirm('Buyurtmani bekor qilmoqchimisiz?')">
            <button type="submit" class="btn btn-danger w-100 mb-3">
              ‚ùå Buyurtmani bekor qilish
            </button>
          </form>

          <!-- Back to Orders -->
          <a href="/my-orders" class="btn btn-outline-secondary w-100">
            ‚Üê Buyurtmalarga qaytish
          </a>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Footer -->
<footer class="bg-dark text-white text-center py-4 mt-5">
  <div class="container">
    <p class="mb-0">&copy; 2026 NextPizza. Barcha huquqlar himoyalangan.</p>
  </div>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>